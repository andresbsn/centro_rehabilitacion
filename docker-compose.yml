services:
  postgres:
    image: postgres:15
    environment:
      POSTGRES_USER: admin
      POSTGRES_PASSWORD: Cambiala123!
      POSTGRES_DB: app_db
    volumes:
      - pgdata:/var/lib/postgresql/data
    networks:
      - app-net
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U admin -d app_db"]
      interval: 5s
      timeout: 5s
      retries: 20

  backend:
    build: ./backend
    environment:
      PORT: "4000"
      NODE_ENV: "production"
      DATABASE_URL: "postgresql://admin:Cambiala123!@postgres:5432/app_db?schema=public"
      JWT_SECRET: "change-me"
      JWT_EXPIRES_IN: "7d"
      CLINIC_NAME: "Centro de Rehabilitacion"
      FRONTEND_URL: "http://localhost:8083"
      SMTP_HOST: ""
      SMTP_PORT: "587"
      SMTP_USER: ""
      SMTP_PASS: ""
      EMAIL_FROM: "turnos@centro.com"
    depends_on:
      postgres:
        condition: service_healthy
    networks:
      - app-net

  frontend:
    build: ./frontend
    depends_on:
      - backend
    networks:
      - app-net
    ports:
      - "8083:80"     # ✅ público sin chocar

networks:
  app-net:
    name: tu_repo_net

volumes:
  pgdata:
